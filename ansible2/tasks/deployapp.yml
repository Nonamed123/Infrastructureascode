---
- name: Deloy app
  hosts: app
  become: true
  tasks:
          - name: Puma | Checkinng file
            stat:
                    path: /root/reddit
            register: stat_result

          - name: Fetch the latest version of application code
            git:
                    repo: 'https://github.com/Artemmkin/reddit.git'
                    dest: /root/reddit
                    version: monolith
            tags: deploy-tag
            when: stat_result.stat.exists == True
            notify: restart puma

          - name: Bundle install
            bundler:
                    state: present
                    chdir: /root/reddit
            tags: deploy-tag

  handlers:
         - name: restart puma
           become: true
           systemd: name=puma state=restarted
